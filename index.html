<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>10A8 — Dashboard lớp (Full UI)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/app.css">
  <link rel="stylesheet" href="assets/css/theme.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>
  <div id="app" class="d-flex">
    <!-- Sidebar -->
    <nav id="sidebar" class="p-3 border-end">
      <h5 class="mb-3">Lớp 10A8</h5>
      <div class="list-group list-group-flush" id="navLinks">
        <a class="list-group-item list-group-item-action active" data-page="home" href="#">🏠 Trang chủ</a>
        <a class="list-group-item list-group-item-action" data-page="students" href="#">👨‍🎓 Học sinh</a>
        <a class="list-group-item list-group-item-action" data-page="timetable" href="#">🗓️ Thời khóa biểu</a>
        <a class="list-group-item list-group-item-action" data-page="awards" href="#">🏅 Khen thưởng</a>
        <a class="list-group-item list-group-item-action" data-page="violations" href="#">🚩 Vi phạm</a>
        <a class="list-group-item list-group-item-action" data-page="discipline" href="#">📏 Nề nếp</a>
        <a class="list-group-item list-group-item-action" data-page="activities" href="#">📣 Phong trào</a>
        <a class="list-group-item list-group-item-action" data-page="attendance" href="#">🧾 Điểm danh</a>
        <a class="list-group-item list-group-item-action" data-page="events" href="#">📅 Sự kiện</a>
        <a class="list-group-item list-group-item-action" data-page="resources" href="#">📚 Tài nguyên</a>
        <a class="list-group-item list-group-item-action" data-page="feedback" href="#">💬 Góp ý</a>
        <a class="list-group-item list-group-item-action" data-page="config" href="#">⚙️ Cấu hình</a>
      </div>
      <hr>
      <div class="small text-muted" id="syncStatus">Chưa đồng bộ</div>
      <div class="mt-2">
        <select id="roleSelect" class="form-select form-select-sm">
          <option value="hocsinh" selected>Vai trò: Học sinh</option>
          <option value="canbo">Cán bộ lớp</option>
          <option value="gvcn">GVCN</option>
          <option value="phuhuynh">Phụ huynh</option>
        </select>
      </div>
      <div class="mt-2 d-grid gap-2">
        <button class="btn btn-sm btn-outline-secondary" id="btnGVCNLogin"><i class="fa-solid fa-lock"></i> Đăng nhập GVCN</button>
        <button class="btn btn-sm btn-outline-danger d-none" id="btnGVCNLogout"><i class="fa-solid fa-right-from-bracket"></i> Đăng xuất</button>
      </div>
    </nav>

    <!-- Main -->
    <main id="main" class="flex-grow-1 p-3">
      <!-- Home -->
      <section class="page" data-page="home">
        <div class="row g-3">
          <div class="col-12 col-lg-8">
            <div class="card h-100">
              <div class="card-header">📢 Thông báo</div>
              <div class="card-body" id="announcements"></div>
            </div>
          </div>
          <div class="col-12 col-lg-4">
            <div class="card mb-3">
              <div class="card-header">🎂 Sinh nhật</div>
              <div class="card-body" id="birthdays"></div>
            </div>
            <div class="card">
              <div class="card-header">👥 Thống kê</div>
              <div class="card-body">
                <div>Tổng số học sinh: <strong id="statTotal">–</strong></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Students -->
      <section class="page d-none" data-page="students">
        <div class="d-flex align-items-center gap-2 mb-3">
          <input id="studentsSearch" class="form-control" placeholder="Tìm tên, mã số...">
          <button class="btn btn-outline-primary" id="btnRefresh"><i class="fa-solid fa-rotate"></i> Làm mới</button>
        </div>
        <div id="studentsList" class="row g-2"></div>
      </section>

      <!-- Timetable -->
      <section class="page d-none" data-page="timetable">
        <div id="timetableWrap" class="table-responsive"></div>
      </section>

      <!-- Awards -->
      <section class="page d-none" data-page="awards">
        <div class="d-flex align-items-center gap-2 mb-3">
          <input id="awardsSearch" class="form-control" placeholder="Tìm theo tên / loại...">
        </div>
        <div id="awardsList" class="row g-2"></div>
      </section>

      <!-- Violations -->
      <section class="page d-none" data-page="violations">
        <div class="d-flex align-items-center gap-2 mb-3">
          <input id="violationsSearch" class="form-control" placeholder="Tìm theo tên / mức độ...">
        </div>
        <div id="violationsList" class="row g-2"></div>
      </section>

      <!-- Discipline -->
      <section class="page d-none" data-page="discipline">
        <div id="disciplineList" class="row g-2"></div>
      </section>

      <!-- Activities -->
      <section class="page d-none" data-page="activities">
        <div id="activitiesList" class="row g-2"></div>
      </section>

      <!-- Attendance -->
      <section class="page d-none" data-page="attendance">
        <div id="attendanceWrap" class="table-responsive"></div>
      </section>

      <!-- Events -->
      <section class="page d-none" data-page="events">
        <div id="eventsList" class="row g-2"></div>
      </section>

      <!-- Resources -->
      <section class="page d-none" data-page="resources">
        <div id="resourcesList" class="row g-2"></div>
      </section>

      <!-- Feedback -->
      <section class="page d-none" data-page="feedback">
        <div id="feedbackList" class="row g-2"></div>
      </section>

      <!-- Config -->
      <section class="page d-none" data-page="config">
        <div class="card">
          <div class="card-header">Cấu hình Google Sheets</div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-8">
                <label class="form-label">Spreadsheet ID</label>
                <input id="sheetId" class="form-control" placeholder="1AbC...">
              </div>
              <div class="col-md-4">
                <label class="form-label">API Key (tùy chọn)</label>
                <input id="apiKey" class="form-control" placeholder="AIza...">
              </div>
            </div>
            <div class="mt-3 d-flex gap-2">
              <button id="btnSaveConfig" class="btn btn-primary"><i class="fa-solid fa-floppy-disk"></i> Lưu & đồng bộ</button>
              <button id="btnResetConfig" class="btn btn-outline-danger">Xóa cấu hình</button>
            </div>
            <hr>
            <p class="small text-muted mb-0">
              • Có API key → dùng Google Sheets API v4 (ổn định).<br>
              • Không có API key → dùng chế độ gviz (có thể thay đổi theo Google).<br>
              • ID/API được lưu localStorage trên trình duyệt của bạn.
            </p>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- GVCN Auth Modal -->
  <div class="modal fade" id="gvcnAuthModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Xác thực GVCN</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="authSetup" class="d-none">
            <p class="small text-muted">Thiết lập PIN GVCN lần đầu. Lưu ý: chỉ bảo vệ trên máy này (localStorage).</p>
            <div class="mb-2">
              <label class="form-label">PIN mới</label>
              <input type="password" class="form-control" id="setupPin" placeholder="Nhập PIN (4–12 ký tự)">
            </div>
            <div class="mb-2">
              <label class="form-label">Xác nhận PIN</label>
              <input type="password" class="form-control" id="setupPin2" placeholder="Nhập lại PIN">
            </div>
            <button class="btn btn-primary w-100" id="btnSetupPin">Lưu PIN</button>
          </div>
          <div id="authLogin" class="">
            <div class="mb-2">
              <label class="form-label">PIN GVCN</label>
              <input type="password" class="form-control" id="loginPin" placeholder="Nhập PIN">
            </div>
            <button class="btn btn-primary w-100" id="btnLoginPin">Đăng nhập</button>
            <div class="form-text mt-2">Quên PIN? Xóa dữ liệu trình duyệt (localStorage) để thiết lập lại.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="assets/js/main.js"></script>
</body>
</html>
